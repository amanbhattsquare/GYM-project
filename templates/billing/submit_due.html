{% extends 'base.html' %}

{% block content %}
<!-- Compact Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="custom-breadcrumb mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'dashboard' %}" class="text-decoration-none">
                <i class="mdi mdi-home-outline mdi-18px"></i> Dashboard
            </a>
        </li>
         <li class="breadcrumb-item active" aria-current="page">
            <i class="mdi mdi-account-group mdi-18px"></i> Billing
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <i class="mdi mdi-currency-usd mdi-18px"></i> Submit Due Payment
        </li>
    </ol>
</nav>

 
            <div class="col-md-12 grid-margin">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Submit Due Payment</h4>
        </div>
                    <div class="card-body">
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}
                        <form method="post" action="{% url 'billing:submit_due' %}" class="mt-4">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="member_id">Select Member</label>
                                <select class="form-control" id="member_id" name="member_id" onchange="this.form.submit()">
                                    <option value="">-- Select a Member --</option>
                                    {% for member in members %}
                                        <option value="{{ member.id }}" {% if selected_member.id == member.id %}selected{% endif %}>{{ member.first_name }} {{ member.last_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>

                        {% if selected_member %}
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <h5>Payment Details for {{ selected_member.first_name }} {{ selected_member.last_name }}</h5>
                                    <p><strong>Total Due Amount:</strong> {{ total_due_amount }}</p>
                                </div>
                                {% if active_plan %}
                                <div class="col-md-6">
                                    <h5>Active Plan Details</h5>
                                    <p><strong>Plan:</strong> {{ active_plan.membership_plan.plan_name }}</p>
                                    <p><strong>Start Date:</strong> {{ active_plan.membership_start_date|date:"d-m-Y" }}</p>
                                    <p><strong>End Date:</strong> {{ active_plan.membership_end_date|date:"d-m-Y" }}</p>
                                    <p><strong>Total Amount:</strong> {{ active_plan.total_amount }}</p>
                                    <p><strong>Paid Amount:</strong> {{ active_plan.paid_amount }}</p>

                                </div>
                                {% endif %}
                            </div>
                            {% if total_due_amount > 0 %}
                                <form method="post" action="{% url 'billing:submit_due' %}" class="mt-4">
                                    {% csrf_token %}
                                    <input type="hidden" name="member_id" value="{{ selected_member.id }}">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="amount_paid">Amount to Pay</label>
                                                <input type="number" class="form-control" id="amount_paid" name="amount_paid" step="0.01" min="0.01" max="{{ total_due_amount }}" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                              <div class="form-group">
                                                <label for="payment_mode">Payment Mode</label>
                                                <select class="form-control" id="payment_mode" name="payment_mode" required>
                                                    <option value="cash">Cash</option>
                                                    <option value="upi">UPI</option>
                                                    <option value="credit_card">Credit Card</option>
                                                    <option value="debit_card">Debit Card</option>
                                                    <option value="net_banking">Net Banking</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="transaction_id">Transaction ID</label>
                                                <input type="text" class="form-control" id="transaction_id" name="transaction_id">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="comment">Comment</label>
                                                <textarea class="form-control" id="comment" name="comment" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Submit Payment</button>
                                </form>
                            {% else %}
                                <div class="alert alert-success mt-4">No due amount for this member.</div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
    

{% endblock %}
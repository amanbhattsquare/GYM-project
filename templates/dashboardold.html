<!-- Enhanced Gym Dashboard HTML Template - Industry Ready, Modern, Premium UI -->
{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="col-lg-12 px-0">
    <div class="content-wrapper py-4">

        <!-- HEADER -->
        <div class="page-header d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3 class="mb-0 font-weight-bold">Dashboard Overview</h3>
                <small class="text-muted">Your complete gym management analytics</small>
            </div>
            <div>
                <button onclick="window.location.href='{% url 'add_new_member' %}'" class="btn btn-success btn-sm">+ Add Member</button>
                <button onclick="window.location.href='{% url 'billing:submit_due' %}'" class="btn btn-primary btn-sm ml-2">+ Add Payment</button>
            </div>
        </div>

        <!-- TOP METRICS -->
        <div class="row">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-sm bg-primary text-white">
                    <div class="card-body">
                        <p class="mb-1">Total Members</p>
                        <h3>{{ total_members }}</h3>
                        <small>Updated today</small>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-sm bg-success text-white">
                    <div class="card-body">
                        <p class="mb-1">Active Members</p>
                        <h3>{{ active_members }}</h3>
                        <small>Updated today</small>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-sm bg-danger text-white">
                    <div class="card-body">
                        <p class="mb-1">Expired Members</p>
                        <h3>{{ inactive_members }}</h3>
                        <small>Expired in last 30 days</small>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-sm bg-warning text-white">
                    <div class="card-body">
                        <p class="mb-1">New (30 Days)</p>
                        <h3>{{ new_members_last_30_days }}</h3>
                        <small>New registrations</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUICK ACTION BUTTONS -->
        <div class="row mb-4">
            <div class="col-md-3">
                <a href="{% url 'add_new_member' %}" class="btn btn-primary btn-block shadow-sm text-white">
                    <i class="fas fa-user-plus mr-2"></i> Add Member
                </a>
            </div>
            <div class="col-md-3">
                <a href="{% url 'add_new_enquiry' %}" class="btn btn-info btn-block shadow-sm text-white">
                    <i class="fas fa-comment-dollar mr-2"></i> New Enquiry
                </a>
            </div>
            <div class="col-md-3">
                <a href="{% url 'billing:submit_due' %}" class="btn btn-success btn-block shadow-sm text-white">
                    <i class="fas fa-money-bill-wave mr-2"></i> Make a Payment
                </a>
            </div>
            <div class="col-md-3">
                <a href="{% url 'expense_add' %}" class="btn btn-danger btn-block shadow-sm text-white">
                    <i class="fas fa-file-invoice-dollar mr-2"></i> Add Expense
                </a>
            </div>
        </div>

       

        <!-- MEMBER GROWTH CHART -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0 font-weight-bold">Member Growth</h5>
                <small>Last 6 Months</small>
            </div>
            <div class="card-body">
                <canvas id="member-growth-chart" style="height: 300px;"></canvas>
            </div>
        </div>

        <!-- ATTENDANCE + CLASSES -->
        <div class="row">
            <div class="col-xl-8 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body overflow-auto">
                        <h5 class="mb-3">Today's Attendance</h5>
                        <table class="table">
                            <thead class="thead-light">
                                <tr>
                                    <th>Member</th>
                                    <th>Check-in Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Aman Verma</td>
                                    <td>06:45 AM</td>
                                    <td><span class="badge badge-success">Present</span></td>
                                </tr>
                                <tr>
                                    <td>Priya Singh</td>
                                    <td>07:10 AM</td>
                                    <td><span class="badge badge-success">Present</span></td>
                                </tr>
                                <tr>
                                    <td>Rohit Sharma</td>
                                    <td>07:40 AM</td>
                                    <td><span class="badge badge-danger">Expired</span></td>
                                </tr>
                            </tbody>
                        </table>
                        <a href="#" class="text-primary font-weight-bold">View all</a>
                    </div>
                </div>
            </div>

            <div class="col-xl-4 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body d-flex flex-column">
                        <h5 class="mb-3">Today's Attendance</h5>
                        <div class="chart-container my-auto">
                            <canvas id="attendance-chart"></canvas>
                        </div>
                        
                    </div>
                </div>
            </div>

          
        </div>

        <!-- Expiries Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0 font-weight-bold">Memership Expiries</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="font-weight-bold">Expired</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="bg-danger text-white">
                                    <tr>
                                        <th>#</th>
                                        <th>Member</th>
                                        <th>Plan</th>
                                        <th>Expiry Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for member in expired_members %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ member.name }}</td>
                                        <td>{{ member.latest_membership.plan.title }}</td>
                                        <td>{{ member.latest_membership.get_end_date|date:"d M Y" }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="3" class="text-center">No data available</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="font-weight-bold">Upcoming</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="bg-warning text-white">
                                    <tr>
                                        <th>#</th>
                                        <th>Member</th>
                                        <th>Plan</th>
                                        <th>Expiry Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for member in upcoming_expiries %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ member.first_name }} {{ member.last_name }}</td>
                                        <td>{{ member.latest_membership.plan.title }}</td>
                                        <td>{{ member.latest_membership.get_end_date|date:"d M Y" }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="3" class="text-center">No data available</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRAINERS, RECENT PAYMENTS & ENQUIRIES -->
        <div class="row">
            <div class="col-xl-8 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body overflow-auto">
                        <h5 class="mb-3">Recent Payments</h5>
                        <table class="table table-sm">
                            <thead class="thead-light">
                                <tr>
                                    <th>Member</th>
                                    <th>Amount</th>
                                    <th>Mode</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Aman Verma</td>
                                    <td>₹ 1,500</td>
                                    <td>Cash</td>
                                    <td>21 Nov 2025</td>
                                </tr>
                                <tr>
                                    <td>Priya Singh</td>
                                    <td>₹ 2,500</td>
                                    <td>Card</td>
                                    <td>20 Nov 2025</td>
                                </tr>
                                <tr>
                                    <td>Rahul Mehra</td>
                                    <td>₹ 3,000</td>
                                    <td>UPI</td>
                                    <td>19 Nov 2025</td>
                                </tr>
                            </tbody>
                        </table>
                        <a href="#" class="text-primary font-weight-bold">View all transactions</a>
                    </div>
                </div>
            </div>

            <div class="col-xl-4     mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="mb-3">Enquiries & Follow-ups</h5>
                        <ul class="list-unstyled">
                            <li class="mb-3">
                                <strong>Rhea</strong>
                                <div class="small text-muted">Trial requested — 1 Nov 2025</div>
                                <div><span class="badge badge-pill badge-warning">Follow-up</span></div>
                            </li>
                            <li class="mb-3">
                                <strong>Vikas</strong>
                                <div class="small text-muted">Asked about plans — 20 Oct 2025</div>
                                <div><span class="badge badge-pill badge-success">New</span></div>
                            </li>
                        </ul>
                        <a href="#" class="text-primary font-weight-bold">Manage enquiries</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUICK ACTIONS BAR -->
        <div class="card shadow-sm mb-4">
            <div class="card-body d-flex flex-wrap align-items-center justify-content-between">
                <div class="d-flex">
                    <button class="btn btn-outline-primary mr-2">+ Add Member</button>
                    <button class="btn btn-outline-success mr-2">+ Add Payment</button>
                    <button class="btn btn-outline-info mr-2">Create Invoice</button>
                    <button class="btn btn-outline-warning">Send Reminder</button>
                </div>
                <div>
                    <small class="text-muted">Last synced: {% now "d M Y" %}</small>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block javascript %}
<!-- Chart.js CDN (ensure base.html doesn't already include) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
// Enhanced Member Growth Chart
const ctx = document.getElementById('member-growth-chart').getContext('2d');

// Creating a gradient for the fill
const gradient = ctx.createLinearGradient(0, 0, 0, 300);
gradient.addColorStop(0, 'rgba(54, 162, 235, 0.25)');
gradient.addColorStop(1, 'rgba(54, 162, 235, 0)');

const memberGrowthChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'],
        datasets: [{
            label: 'New Members',
            data: [12, 18, 22, 30, 25, 18],
            tension: 0.3,
            fill: true,
            backgroundColor: gradient,
            borderColor: '#36A2EB',
            pointBackgroundColor: '#fff',
            pointBorderColor: '#36A2EB',
            pointHoverRadius: 6,
            pointHoverBackgroundColor: '#36A2EB',
            pointRadius: 4,
            borderWidth: 2,
        }, {
            label: 'Active Members',
            data: [80, 85, 90, 105, 115, 120],
            tension: 0.3,
            fill: false,
            borderColor: '#4BC0C0',
            pointBackgroundColor: '#fff',
            pointBorderColor: '#4BC0C0',
            pointHoverRadius: 6,
            pointHoverBackgroundColor: '#4BC0C0',
            pointRadius: 4,
            borderWidth: 2,
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    font: {
                        size: 14,
                        family: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"
                    }
                }
            },
            tooltip: {
                enabled: true,
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleFont: {
                    size: 16,
                    weight: 'bold',
                },
                bodyFont: {
                    size: 14,
                },
                callbacks: {
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.y !== null) {
                            label += context.parsed.y;
                        }
                        return label;
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(200, 200, 200, 0.2)', // Lighter grid lines
                },
                ticks: {
                    font: {
                        size: 12,
                    }
                }
            },
            x: {
                grid: {
                    display: false, // Hide x-axis grid lines
                },
                ticks: {
                    font: {
                        size: 12,
                    }
                }
            }
        },
        interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
        }
    }
});

// Static sample data for Attendance doughnut chart
const attendanceCtx = document.getElementById('attendance-chart').getContext('2d');
const attendanceChart = new Chart(attendanceCtx, {
    type: 'doughnut',
    data: {
        labels: ['Present', 'Absent'],
        datasets: [{
            label: 'Attendance',
            data: [2, 1], // Sample data: 2 present, 1 absent
            backgroundColor: [
                'rgba(9, 155, 155, 0.95)', // Success color
                'rgba(226, 168, 20, 0.87)', // Warning color
                
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: {
                        size: 12
                    }
                }
            },
            tooltip: {
                enabled: true,
            }
        }
    }
});
</script>
{% endblock %}
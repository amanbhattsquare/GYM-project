{% extends 'superadmin/base.html' %}
{% load static %}

{% block title %}Assign Subscription{% endblock %}

{% block content %}
<div class="col-lg-12 px-0">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Assign Subscription to Gym</h2>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="gym">Select Gym</label>
                            <select class="form-control" id="gym" name="gym">
                                {% for gym in gyms %}
                                    <option value="{{ gym.id }}">{{ gym.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="subscription">Select Subscription Plan</label>
                            <select class="form-control" id="subscription" name="subscription">
                                {% for subscription in subscriptions %}
                                    <option value="{{ subscription.id }}" data-price="{{ subscription.price }}" data-duration="{{ subscription.duration_months }}">{{ subscription.name }} - {{ subscription.price }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="start_date">Start Date</label>
                            <input type="date" class="form-control" id="start_date" name="start_date" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="duration">Duration (months)</label>
                            <input type="text" class="form-control" id="duration" name="duration" readonly>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="discount">Discount</label>
                            <input type="number" class="form-control" id="discount" name="discount" value="0">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="total_amount">Total Amount</label>
                            <input type="text" class="form-control" id="total_amount" name="total_amount" readonly>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="paid_amount">Paid Amount</label>
                            <input type="number" class="form-control" id="paid_amount" name="paid_amount" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="payment_mode">Payment Mode</label>
                            <select class="form-control" id="payment_mode" name="payment_mode">
                                <option value="cash">Cash</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="debit_card">Debit Card</option>
                                <option value="net_banking">Net Banking</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="transaction_id">Transaction ID</label>
                            <input type="text" class="form-control" id="transaction_id" name="transaction_id">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="remark">Remark</label>
                            <textarea class="form-control" id="remark" name="remark" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Assign Subscription</button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const subscriptionSelect = document.getElementById('subscription');
    const durationInput = document.getElementById('duration');
    const discountInput = document.getElementById('discount');
    const totalAmountInput = document.getElementById('total_amount');

    function updateTotalAmount() {
        const selectedOption = subscriptionSelect.options[subscriptionSelect.selectedIndex];
        const price = parseFloat(selectedOption.dataset.price) || 0;
        const discount = parseFloat(discountInput.value) || 0;
        const totalAmount = price - discount;
        totalAmountInput.value = totalAmount.toFixed(2);
    }

    function updateDuration() {
        const selectedOption = subscriptionSelect.options[subscriptionSelect.selectedIndex];
        durationInput.value = selectedOption.dataset.duration || '';
    }

    subscriptionSelect.addEventListener('change', function() {
        updateDuration();
        updateTotalAmount();
    });
    discountInput.addEventListener('input', updateTotalAmount);

    // Initial calculation
    updateDuration();
    updateTotalAmount();
});
</script>
{% endblock %}
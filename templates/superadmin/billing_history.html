{% extends "superadmin/base.html" %}
{% load static %}
{% block title %}Billing History{% endblock title %}

{% block content %}
<style>
    .subscription-row {
        background-color: #f2f2f2; /* Light gray for subscriptions */
    }
    .payment-row {
        background-color: #e6f7ff; /* Light blue for payments */
    }
</style>

<!-- Compact Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="custom-breadcrumb mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'superadmin:dashboard' %}" class="text-decoration-none">
                <i class="mdi mdi-home-outline mdi-18px"></i> Dashboard
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <i class="mdi mdi-account-group mdi-18px"></i> Billing
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <i class="mdi mdi-history mdi-18px"></i> Billing History
        </li>
    </ol>
</nav>
<div class="col-lg-12 px-0">
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Billing History</h4>
            <a href="#" class="btn btn-danger btn-sm"><i class="mdi mdi-delete-empty"></i> Trash</a>
        </div>
        <div class="card-body">
            <form method="get" class="mb-4">
                <div class="row">
                    <div class="col-md-3">
                        {% include 'includes/search_form.html' %}
                    </div>
                    <div class="col-md-3">
                        <select name="status" class="form-control">
                            <option value="">All Statuses</option>
                            <option value="paid">Paid</option>
                            <option value="unpaid">Unpaid</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="type" class="form-control">
                            <option value="">All Types</option>
                            <option value="subscription">Subscription</option>
                            <option value="payment">Payment</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary"><i class="mdi mdi-filter-variant"></i> Filter</button>
                        <a href="{% url 'superadmin:billing_history' %}" class="btn btn-secondary"><i class="mdi mdi-refresh"></i> Clear</a>
                    </div>
                </div>
            </form>
            <div class="table-responsive">
                <table class="table table-hover table-sm table-stack-on-mobile">
                    <thead>
                        <tr>
                            <th>Sr. No</th>
                            <th class="font-weight-semibold py-2">Date</th>
                            <th class="font-weight-semibold py-2">Type</th>
                            <th class="font-weight-semibold py-2">Gym Name</th>
                            <th class="font-weight-semibold py-2">Amount</th>
                            <th class="font-weight-semibold py-2">Status/Method</th>
                            <th class="font-weight-semibold py-2">Notes/Plan</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in history %}
                        <tr class="{% if item.is_subscription %}subscription-row{% else %}payment-row{% endif %}">
                            <td>{{ forloop.counter0|add:history.start_index }}</td>
                            {% if item.is_subscription %}
                                <td data-label="Date">{{ item.start_date|date:'d-m-Y H:i' }}</td>
                                <td data-label="Type"><i class="mdi mdi-file-document-box"></i> Subscription</td>
                                <td data-label="Gym Name">{{ item.gym.name }}</td>
                                <td data-label="Amount">₹{{ item.total_amount|floatformat:2 }}</td>
                                <td data-label="Status/Method">
                                    {% if item.due_amount_calculated == 0 %}
                                        <span class="badge badge-success">Paid</span>
                                    {% else %}
                                        <span class="badge badge-warning">Unpaid</span>
                                    {% endif %}
                                </td>
                                <td data-label="Notes/Plan">{{ item.subscription.name }}</td>
                            {% else %}
                                <td data-label="Date">{{ item.payment_date|date:'d-m-Y H:i' }}</td>
                                <td data-label="Type"><i class="mdi mdi-currency-usd"></i> Payment</td>
                                <td data-label="Gym Name">{{ item.gym.name }}</td>
                                <td data-label="Amount">₹{{ item.amount|floatformat:2 }}</td>
                                <td data-label="Status/Method">{{ item.get_payment_mode_display }}</td>
                                <td data-label="Notes/Plan">{{ item.comment }}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if history.has_other_pages %}
                {% include 'includes/pagination.html' with page_obj=history %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %}